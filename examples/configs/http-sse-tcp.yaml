# HTTP-SSE-TCP 混合架构配置
# 适用场景：标准部署，控制平面使用HTTP+SSE，数据平面使用TCP

component:
  id: "controller-001"
  type: "controller"
  version: "1.0.0"

server:
  http:
    enabled: true
    address: ":8080"
    read_timeout: 30s
    write_timeout: 30s
    idle_timeout: 120s
  
  grpc:
    enabled: false  # 混合架构不使用gRPC

transport:
  mode: "http-sse-tcp"  # 混合传输模式
  
  # SSE配置（控制平面）
  sse:
    enabled: true
    heartbeat_interval: 30s
    max_clients: 1000
    buffer_size: 256
  
  # TCP代理配置（数据平面）
  tcp_proxy:
    enabled: true
    address: ":9443"
    connect_timeout: 10s
    idle_timeout: 300s
    buffer_size: 32768  # 32KB缓冲区
    max_connections: 500

# TLS配置
tls:
  cert_file: "../../certs/controller-cert.pem"
  key_file: "../../certs/controller-key.pem"
  ca_file: "../../certs/ca-cert.pem"
  min_version: "1.2"
  mutual_auth: true

# 日志配置
logging:
  level: "info"
  format: "json"
  output: "stdout"
  audit_file: "./logs/audit.log"

# 数据库配置
database:
  type: "sqlite"
  dsn: "controller.db"
  max_connections: 10
  connection_lifetime: 3600s

# 策略配置
policy:
  default_action: "deny"
  cache_ttl: 300s
  max_cache_size: 10000

# 隧道配置
tunnel:
  default_ttl: 3600s        # 默认隧道TTL：1小时
  max_concurrent: 100       # 最大并发隧道数
  cleanup_interval: 60s     # 清理间隔

# 会话配置
session:
  timeout: 1800s            # 会话超时：30分钟
  max_idle: 600s            # 最大空闲时间：10分钟
  cleanup_interval: 120s    # 清理间隔

# 告警配置
alerting:
  enabled: true
  rules:
    - name: "cert_expiring"
      condition: "cert.days_until_expiry < 30"
      severity: "warning"
      action: "log"
    
    - name: "high_tunnel_count"
      condition: "tunnel.active_count > 80"
      severity: "warning"
      action: "log"
